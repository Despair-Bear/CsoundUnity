\hypertarget{_children_creator_8cs_source}{}\doxysection{Children\+Creator.\+cs}
\label{_children_creator_8cs_source}\index{Samples$\sim$/GranularSynthesis/Scripts/ChildrenCreator.cs@{Samples$\sim$/GranularSynthesis/Scripts/ChildrenCreator.cs}}
\mbox{\hyperlink{_children_creator_8cs}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00001}00001 \textcolor{keyword}{using} System.Collections;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00002}00002 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00003}00003 \textcolor{keyword}{using} UnityEngine;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00005}00005 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_csound_1_1_granular_synthesis_1_1_partikkel}{Csound.GranularSynthesis.Partikkel}}}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00006}00006 \{}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00007}00007     [RequireComponent(typeof(\mbox{\hyperlink{class_csound_unity}{CsoundUnity}}))]}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00008}\mbox{\hyperlink{class_csound_1_1_granular_synthesis_1_1_partikkel_1_1_children_creator}{00008}}     \textcolor{keyword}{public} \textcolor{keyword}{class }\mbox{\hyperlink{class_csound_1_1_granular_synthesis_1_1_partikkel_1_1_children_creator}{ChildrenCreator}} : MonoBehaviour}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00009}00009     \{}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00010}00010         [Tooltip(\textcolor{stringliteral}{"{}The radius of the circle where the children will be placed, starting from the position of this GameObject"{}})]}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00011}00011         [SerializeField] \textcolor{keyword}{private} \textcolor{keywordtype}{float} \_radius = 200f;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00012}00012         [Tooltip(\textcolor{stringliteral}{"{}How many meters more the sources will be audible from. This value will be summed to the radius. "{}} +}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00013}00013             \textcolor{stringliteral}{"{}It is to make sure that there will be some sound when the player is equidistant from the sources"{}})]}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00014}00014         [SerializeField] \textcolor{keyword}{private} \textcolor{keywordtype}{float} \_rollofTolerance = 100f;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00015}00015         [Tooltip(\textcolor{stringliteral}{"{}The prefab to be used as a 3D meter, must have a Child3DMeter script"{}})]}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00016}00016         [SerializeField] \textcolor{keyword}{private} GameObject \_childMeterPrefab;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00018}00018         \textcolor{keyword}{private} \mbox{\hyperlink{class_csound_unity}{CsoundUnity}} \_csound;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00019}00019         \textcolor{keyword}{private} Dictionary<string, Child3DMeter> \_meters;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00021}00021         IEnumerator Start()}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00022}00022         \{}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00023}00023             \_csound = GetComponent<CsoundUnity>();}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00025}00025             \textcolor{keywordflow}{while} (!\_csound.\mbox{\hyperlink{class_csound_unity_ae2c648d0f6245fb84c5f9ec5176079ff}{IsInitialized}})}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00026}00026                 yield \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00028}00028             var n = \_csound.\mbox{\hyperlink{class_csound_unity_ae00b36e523ed56c3d80c1930bec1a30e}{availableAudioChannels}}.Count;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00030}00030             \_meters = \textcolor{keyword}{new} Dictionary<string, Child3DMeter>();}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00032}00032             \textcolor{keywordflow}{for} (var i = 0; i < n; i++)}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00033}00033             \{}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00034}00034                 var angle = i * Mathf.PI * 2 / n;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00035}00035                 var pos = \textcolor{keyword}{new} Vector3(Mathf.Cos(angle), 0, Mathf.Sin(angle)) * \_radius;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00036}00036                 var go = Instantiate(\_childMeterPrefab, this.transform);}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00037}00037 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00038}00038                 go.transform.position = pos;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00039}00039                 var child = go.AddComponent(typeof(\mbox{\hyperlink{class_csound_unity_child}{CsoundUnityChild}})) as \mbox{\hyperlink{class_csound_unity_child}{CsoundUnityChild}};}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00040}00040                 child.\mbox{\hyperlink{class_csound_unity_child_af687ae511d8bdcae7970f12b5b49c058}{Init}}(\_csound, \mbox{\hyperlink{class_csound_unity_child}{CsoundUnityChild}}.\mbox{\hyperlink{class_csound_unity_child_a327fcfb29d015b5607f6222853b6438c}{AudioChannels}}.MONO);}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00041}00041                 child.SetAudioChannel(0, i);}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00042}00042                 child.name = \_csound.\mbox{\hyperlink{class_csound_unity_ae00b36e523ed56c3d80c1930bec1a30e}{availableAudioChannels}}[i];}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00043}00043                 var meter = go.GetComponent<\mbox{\hyperlink{class_csound_1_1_granular_synthesis_1_1_partikkel_1_1_child3_d_meter}{Child3DMeter}}>();}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00044}00044                 \_meters.Add(\_csound.\mbox{\hyperlink{class_csound_unity_ae00b36e523ed56c3d80c1930bec1a30e}{availableAudioChannels}}[i], meter);}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00045}00045                 var aS = go.GetComponent<AudioSource>();}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00046}00046                 \textcolor{comment}{// set doppler level to 0 to avoid artefacts when the camera moves}}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00047}00047                 aS.dopplerLevel = 0;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00048}00048                 aS.rolloffMode = AudioRolloffMode.Custom;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00049}00049                 \textcolor{comment}{// when the audio listener is 'radius' meters far from the audio source, there will be no sound, }}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00050}00050                 \textcolor{comment}{// since the rolloff function will lower the volume accordingly to the custom curve, and at maxDistance the volume will be 0. }}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00051}00051                 \textcolor{comment}{// Let's add 'rollofTolerance' meters more to have some sound when the listener is equidistant from the created sources}}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00052}00052                 aS.maxDistance = \_radius + \_rollofTolerance;}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00053}00053             \}}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00054}00054         \}}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00056}00056         \textcolor{keywordtype}{void} Update()}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00057}00057         \{}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00058}00058             \textcolor{keywordflow}{foreach} (var meter \textcolor{keywordflow}{in} \_meters)}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00059}00059             \{}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00060}00060                 meter.Value.\mbox{\hyperlink{class_csound_1_1_granular_synthesis_1_1_partikkel_1_1_child3_d_meter_a2de6d90c0b1c7f5e810c48fcab221458}{SetValue}}((\textcolor{keywordtype}{float})\_csound.\mbox{\hyperlink{class_csound_unity_adf9230e5932b098bacc1ee87369707e9}{GetChannel}}(meter.Key + \textcolor{stringliteral}{"{}Vol"{}}) / (\textcolor{keywordtype}{float})\_csound.\mbox{\hyperlink{class_csound_unity_a703b9f858fc381d38886fbdec0b6d8fc}{Get0dbfs}}());}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00061}00061             \}}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00062}00062         \}}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00063}00063     \}}
\DoxyCodeLine{\Hypertarget{_children_creator_8cs_source_l00064}00064 \}}

\end{DoxyCode}
